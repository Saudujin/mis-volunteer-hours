# دليل إعداد Google Sheets لنظام الساعات التطوعية

## نظرة عامة

هذا الدليل يشرح كيفية إعداد Google Sheets للعمل مع نظام تسجيل الساعات التطوعية لنادي نظم المعلومات الإدارية. النظام يتكون من ثلاث أوراق (Sheets) رئيسية تعمل معاً لتتبع الساعات التطوعية للأعضاء.

---

## هيكل Google Sheets

### الورقة الأولى: Members (الأعضاء)

هذه الورقة تحتوي على بيانات جميع أعضاء النادي والساعات التراكمية لكل عضو.

| العمود | الاسم | الوصف |
|--------|-------|-------|
| A | الرقم الجامعي | الرقم الجامعي للعضو (المعرف الرئيسي) |
| B | الاسم | اسم العضو الكامل |
| C | الإيميل | البريد الإلكتروني |
| D | رقم الجوال | رقم الجوال |
| E | المشروع/اللجنة | اسم اللجنة أو المشروع |
| F | الساعات التراكمية | مجموع الساعات المعتمدة (معادلة تلقائية) |
| G | تفاصيل الإنجازات | قائمة الإنجازات المعتمدة (معادلة تلقائية) |

**الصف الأول (Header):**
```
الرقم الجامعي | الاسم | الإيميل | رقم الجوال | المشروع/اللجنة | الساعات التراكمية | تفاصيل الإنجازات
```

---

### الورقة الثانية: Requests (الطلبات)

هذه الورقة تستقبل جميع طلبات الساعات التطوعية من الموقع.

| العمود | الاسم | الوصف |
|--------|-------|-------|
| A | الرقم الجامعي | الرقم الجامعي للطالب |
| B | وصف الإنجاز | وصف ما قام به الطالب |
| C | الساعات | عدد الساعات (يحدده المسؤول عند الموافقة) |
| D | رابط الإثبات | رابط الصورة في Google Drive |
| E | التاريخ | تاريخ تقديم الطلب |
| F | معتمد | TRUE أو FALSE |
| G | معتمد بواسطة | اسم المسؤول الذي وافق |

**الصف الأول (Header):**
```
الرقم الجامعي | وصف الإنجاز | الساعات | رابط الإثبات | التاريخ | معتمد | معتمد بواسطة
```

---

### الورقة الثالثة: AchievementTypes (أنواع الإنجازات)

هذه الورقة تحتوي على قائمة أنواع الإنجازات وعدد الساعات لكل نوع.

| العمود | الاسم | الوصف |
|--------|-------|-------|
| A | اسم الإنجاز | اسم نوع الإنجاز |
| B | الساعات | عدد الساعات لهذا النوع |
| C | تاريخ الإضافة | تاريخ إضافة هذا النوع |

**الصف الأول (Header):**
```
اسم الإنجاز | الساعات | تاريخ الإضافة
```

**أمثلة على أنواع الإنجازات:**
```
حضور اليوم التعريفي | 1 | 2024-01-15
لايك على تغريدة | 0.5 | 2024-01-15
تنظيم فعالية | 4 | 2024-01-15
المشاركة في ورشة عمل | 2 | 2024-01-15
```

---

## المعادلات المطلوبة

### معادلة الساعات التراكمية (العمود F في ورقة Members)

ضع هذه المعادلة في الخلية F2 ثم اسحبها للأسفل:

```
=SUMIFS(Requests!C:C, Requests!A:A, A2, Requests!F:F, "TRUE")
```

**شرح المعادلة:**
- `Requests!C:C` - عمود الساعات في ورقة الطلبات
- `Requests!A:A` - عمود الرقم الجامعي في ورقة الطلبات
- `A2` - الرقم الجامعي للعضو الحالي
- `Requests!F:F` - عمود الموافقة
- `"TRUE"` - فقط الطلبات المعتمدة

---

### معادلة تفاصيل الإنجازات (العمود G في ورقة Members)

ضع هذه المعادلة في الخلية G2 ثم اسحبها للأسفل:

```
=TEXTJOIN(" ، ", TRUE, FILTER(Requests!B:B&" ("&Requests!C:C&" ساعة)", (Requests!A:A=A2)*(Requests!F:F="TRUE")))
```

**شرح المعادلة:**
- `FILTER` - تصفية الطلبات المعتمدة لهذا العضو
- `TEXTJOIN` - دمج النتائج بفاصلة
- النتيجة مثال: `حضرت اليوم التعريفي (1 ساعة) ، حطيت لايك على تغريدة (0.5 ساعة)`

**معادلة بديلة (إذا لم تعمل الأولى):**
```
=IFERROR(TEXTJOIN(" ، ", TRUE, FILTER(Requests!B:B&" ("&Requests!C:C&" ساعة)", (Requests!A:A=A2)*(Requests!F:F="TRUE"))), "")
```

---

## إعداد Google Cloud Console

### الخطوة 1: إنشاء مشروع جديد

1. اذهب إلى [Google Cloud Console](https://console.cloud.google.com/)
2. اضغط على "Select a project" ثم "New Project"
3. أدخل اسم المشروع (مثال: MIS-Volunteer-Hours)
4. اضغط "Create"

### الخطوة 2: تفعيل APIs

1. من القائمة الجانبية، اذهب إلى "APIs & Services" > "Library"
2. ابحث عن وفعّل:
   - **Google Sheets API**
   - **Google Drive API**

### الخطوة 3: إنشاء Service Account

1. اذهب إلى "APIs & Services" > "Credentials"
2. اضغط "Create Credentials" > "Service Account"
3. أدخل اسم (مثال: volunteer-hours-service)
4. اضغط "Create and Continue"
5. اختر Role: "Editor" ثم "Continue"
6. اضغط "Done"

### الخطوة 4: إنشاء مفتاح JSON

1. اضغط على Service Account الذي أنشأته
2. اذهب إلى تبويب "Keys"
3. اضغط "Add Key" > "Create new key"
4. اختر "JSON" واضغط "Create"
5. سيتم تحميل ملف JSON - **احفظه بأمان!**

### الخطوة 5: مشاركة Google Sheet

1. افتح Google Sheet الذي أنشأته
2. اضغط "Share"
3. أضف إيميل Service Account (موجود في ملف JSON كـ `client_email`)
4. أعطه صلاحية "Editor"

---

## إعداد Google Drive Folder

### الخطوة 1: إنشاء مجلد للصور

1. اذهب إلى [Google Drive](https://drive.google.com/)
2. أنشئ مجلد جديد (مثال: "MIS-Volunteer-Proofs")
3. انسخ معرف المجلد من الرابط:
   ```
   https://drive.google.com/drive/folders/[FOLDER_ID]
   ```

### الخطوة 2: مشاركة المجلد

1. اضغط بالزر الأيمن على المجلد > "Share"
2. أضف إيميل Service Account
3. أعطه صلاحية "Editor"

---

## متغيرات البيئة المطلوبة

أضف هذه المتغيرات في إعدادات المشروع:

| المتغير | الوصف | مثال |
|---------|-------|------|
| `GOOGLE_SERVICE_ACCOUNT_KEY` | محتوى ملف JSON كامل | `{"type":"service_account",...}` |
| `GOOGLE_SPREADSHEET_ID` | معرف Google Sheet | `1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms` |
| `GOOGLE_DRIVE_FOLDER_ID` | معرف مجلد الصور | `1dyUEebJaFnWa3Z4n0BFMVAXQ7mfUH11g` |

### كيفية الحصول على Spreadsheet ID

من رابط Google Sheet:
```
https://docs.google.com/spreadsheets/d/[SPREADSHEET_ID]/edit
```

---

## خطوات الإعداد السريع

1. **إنشاء Google Sheet جديد** مع ثلاث أوراق:
   - Members
   - Requests
   - AchievementTypes

2. **إضافة Headers** لكل ورقة كما موضح أعلاه

3. **إضافة المعادلات** في ورقة Members (الأعمدة F و G)

4. **إعداد Google Cloud Console** وإنشاء Service Account

5. **مشاركة الشيت والمجلد** مع Service Account

6. **إضافة متغيرات البيئة** في إعدادات المشروع

7. **إضافة أنواع الإنجازات** الأولية في ورقة AchievementTypes

---

## استكشاف الأخطاء

### خطأ: "Google Service Account credentials not configured"
- تأكد من إضافة `GOOGLE_SERVICE_ACCOUNT_KEY` في متغيرات البيئة
- تأكد من أن المحتوى هو JSON صحيح

### خطأ: "Permission denied"
- تأكد من مشاركة الشيت مع إيميل Service Account
- تأكد من إعطاء صلاحية "Editor"

### خطأ: "Spreadsheet not found"
- تأكد من صحة `GOOGLE_SPREADSHEET_ID`
- تأكد من أن الشيت موجود ومشارك

### الصور لا تظهر
- تأكد من مشاركة مجلد Drive مع Service Account
- تأكد من صحة `GOOGLE_DRIVE_FOLDER_ID`

---

## ملاحظات مهمة

1. **الأمان**: لا تشارك ملف JSON أو متغيرات البيئة مع أي شخص
2. **النسخ الاحتياطي**: قم بعمل نسخة احتياطية من الشيت بشكل دوري
3. **الصلاحيات**: Service Account يحتاج صلاحية Editor فقط، ليس Owner
4. **المعادلات**: تأكد من سحب المعادلات لجميع الصفوف عند إضافة أعضاء جدد

---

## الدعم

إذا واجهت أي مشاكل، تواصل مع فريق التقنية في نادي نظم المعلومات الإدارية.
